# âš¡ å¿«é€Ÿéƒ¨ç½² - ä¿®å¤æ”¯ä»˜å®AppIDé—®é¢˜

## âœ… å·²ä¿®å¤çš„é—®é¢˜

**é”™è¯¯ï¼š** missing-app-idï¼ˆç¼ºå°‘æ”¯ä»˜å®AppIDï¼‰  
**ä¿®å¤ï¼š** æ·»åŠ å®Œæ•´çš„æ”¯ä»˜å®å‚æ•°å’Œç¯å¢ƒå˜é‡æ£€æŸ¥

---

## ğŸš€ ç«‹å³éƒ¨ç½²ï¼ˆ3ç§æ–¹æ³•ï¼‰

### æ–¹æ³•1ï¼šé€šè¿‡Netlify CLIï¼ˆæ¨èï¼‰

```bash
# 1. åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•
cd D:\GoogleMapsScrapeWeb

# 2. å¦‚æœå°šæœªé“¾æ¥ï¼Œå…ˆé“¾æ¥åˆ°ç°æœ‰ç«™ç‚¹
netlify link

# 3. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
netlify deploy --prod
```

**æ“ä½œæ­¥éª¤ï¼š**
1. è¿è¡Œ `netlify link`
2. é€‰æ‹© "Link this directory to an existing project"
3. é€‰æ‹©æ‚¨çš„ç«™ç‚¹ï¼ˆmediamingle.cnï¼‰
4. è¿è¡Œ `netlify deploy --prod`
5. ç¡®è®¤éƒ¨ç½²

---

### æ–¹æ³•2ï¼šé€šè¿‡Gitè‡ªåŠ¨éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼‰

```bash
cd D:\GoogleMapsScrapeWeb

# 1. æäº¤æ›´æ”¹
git add netlify/functions/createRenewalOrder.js
git commit -m "ä¿®å¤æ”¯ä»˜å®AppIDç¼ºå¤±é—®é¢˜"

# 2. æ¨é€åˆ°GitHub
git push origin main
```

**Netlifyä¼šè‡ªåŠ¨éƒ¨ç½²ï¼** âš¡

---

### æ–¹æ³•3ï¼šé€šè¿‡Netlifyç½‘é¡µç•Œé¢

1. è®¿é—®ï¼šhttps://app.netlify.com
2. é€‰æ‹©æ‚¨çš„ç«™ç‚¹
3. ç‚¹å‡»ï¼š**Deploys** æ ‡ç­¾
4. ç‚¹å‡»ï¼š**Trigger deploy** â†’ **Deploy site**

---

## ğŸ§ª éªŒè¯éƒ¨ç½²

### æµ‹è¯•1ï¼šæ£€æŸ¥å‡½æ•°çŠ¶æ€

è®¿é—®ï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„å®é™…åŸŸåï¼‰ï¼š
```
https://mediamingle.cn/.netlify/functions/createRenewalOrder
```

**é¢„æœŸå“åº”ï¼š**
```json
{
  "success": false,
  "message": "Method Not Allowed"
}
```

**âœ… å¦‚æœçœ‹åˆ°è¿™ä¸ªå“åº”ï¼Œè¯´æ˜å‡½æ•°å·²éƒ¨ç½²æˆåŠŸï¼**

---

### æµ‹è¯•2ï¼šæµ‹è¯•ç»­è´¹åŠŸèƒ½

```bash
cd D:\gogole_maps
python Maps_scraper.py
```

1. ç™»å½•ç¨‹åº
2. ç‚¹å‡»ï¼š**å¸®åŠ©** â†’ **ç»­è´¹æœåŠ¡**
3. é€‰æ‹©ç»­è´¹æ–¹æ¡ˆ
4. ç‚¹å‡»ï¼š**ç”Ÿæˆæ”¯ä»˜äºŒç»´ç **

**é¢„æœŸç»“æœï¼š**
- âœ… äºŒç»´ç æ­£å¸¸ç”Ÿæˆå¹¶æ˜¾ç¤º
- âœ… ä¸å†å‡ºç° "missing-app-id" é”™è¯¯
- âœ… å¯ä»¥çœ‹åˆ°å®Œæ•´çš„äºŒç»´ç 

**âš ï¸ æ³¨æ„ï¼š**
- å¦‚æœæ‰«ç ä¼šè·³è½¬åˆ°æµ‹è¯•é¡µé¢ï¼ˆå› ä¸ºæ²¡æœ‰é…ç½®çœŸå®æ”¯ä»˜å®ï¼‰
- è¿™æ˜¯æ­£å¸¸çš„ï¼Œå¯ä»¥å…ˆæµ‹è¯•UI

---

## ğŸ“Š ä¿®å¤è¯¦æƒ…

### ä¿®æ”¹çš„æ–‡ä»¶
- `netlify/functions/createRenewalOrder.js`

### ä¿®æ”¹å†…å®¹

#### 1. ç¯å¢ƒå˜é‡æ£€æŸ¥
```javascript
const alipayAppId = process.env.ALIPAY_APP_ID;

if (!alipayAppId) {
  console.warn('âš ï¸ æœªé…ç½®æ”¯ä»˜å®å‚æ•°ï¼Œè¿”å›æµ‹è¯•URL');
  return `https://mediamingle.cn/test-payment?orderId=${orderId}&...`;
}
```

#### 2. æ·»åŠ å®Œæ•´çš„æ”¯ä»˜å®å‚æ•°
```javascript
const params = {
  app_id: alipayAppId,              // âœ… ä¿®å¤ï¼šæ·»åŠ AppID
  method: 'alipay.trade.wap.pay',   // âœ… æ¥å£åç§°
  format: 'JSON',                    // âœ… æ ¼å¼
  charset: 'utf-8',                  // âœ… ç¼–ç 
  sign_type: 'RSA2',                 // âœ… ç­¾åç±»å‹
  timestamp: '...',                  // âœ… æ—¶é—´æˆ³
  version: '1.0',                    // âœ… ç‰ˆæœ¬
  biz_content: JSON.stringify({     // âœ… ä¸šåŠ¡å‚æ•°
    out_trade_no: orderId,
    total_amount: amount.toFixed(2),
    subject: subject,
    product_code: 'QUICK_WAP_PAY'
  }),
  notify_url: '...',                 // âœ… å›è°ƒåœ°å€
  return_url: '...'                  // âœ… è¿”å›åœ°å€
};
```

#### 3. å‚æ•°æ’åºå’Œç¼–ç 
```javascript
const queryString = Object.entries(params)
  .filter(([key, value]) => value)           // è¿‡æ»¤ç©ºå€¼
  .sort(([a], [b]) => a.localeCompare(b))   // æŒ‰é”®åæ’åº
  .map(([key, value]) => `${key}=${encodeURIComponent(value)}`)
  .join('&');
```

---

## ğŸ¯ å½“å‰çŠ¶æ€

### âœ… å·²ä¿®å¤
- [x] æ·»åŠ  `app_id` å‚æ•°
- [x] æ·»åŠ æ‰€æœ‰å¿…éœ€çš„æ”¯ä»˜å®å‚æ•°
- [x] ç¯å¢ƒå˜é‡æ£€æŸ¥
- [x] æµ‹è¯•URLç”Ÿæˆï¼ˆæœªé…ç½®æ—¶ï¼‰
- [x] å‚æ•°æ’åºå’Œç¼–ç 

### â³ å¾…éƒ¨ç½²
- [ ] éƒ¨ç½²åˆ°Netlifyç”Ÿäº§ç¯å¢ƒ
- [ ] æµ‹è¯•éªŒè¯

### ğŸ”„ æœªæ¥ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰
- [ ] é…ç½®çœŸå®æ”¯ä»˜å®AppID
- [ ] å®‰è£…æ”¯ä»˜å®SDK
- [ ] å®ç°RSA2ç­¾å
- [ ] çœŸå®æ”¯ä»˜åŠŸèƒ½

---

## ğŸ’¡ éƒ¨ç½²å‘½ä»¤æ€»ç»“

### å¦‚æœé¡¹ç›®å·²é“¾æ¥
```bash
cd D:\GoogleMapsScrapeWeb
netlify deploy --prod
```

### å¦‚æœé¡¹ç›®æœªé“¾æ¥
```bash
cd D:\GoogleMapsScrapeWeb
netlify link                    # å…ˆé“¾æ¥
netlify deploy --prod           # å†éƒ¨ç½²
```

### æˆ–è€…ä½¿ç”¨Gitè‡ªåŠ¨éƒ¨ç½²
```bash
git add .
git commit -m "ä¿®å¤æ”¯ä»˜å®AppIDé—®é¢˜"
git push origin main            # Netlifyè‡ªåŠ¨éƒ¨ç½²
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šnetlifyå‘½ä»¤æœªæ‰¾åˆ°
```bash
# å®‰è£…Netlify CLI
npm install -g netlify-cli

# ç™»å½•
netlify login
```

### é—®é¢˜2ï¼šé¡¹ç›®æœªé“¾æ¥
```bash
# é“¾æ¥åˆ°ç°æœ‰é¡¹ç›®
netlify link

# æˆ–è€…æŸ¥çœ‹å½“å‰çŠ¶æ€
netlify status
```

### é—®é¢˜3ï¼šéƒ¨ç½²å¤±è´¥
```bash
# æŸ¥çœ‹æ—¥å¿—
netlify deploy --prod --debug

# æˆ–åœ¨ç½‘é¡µä¸ŠæŸ¥çœ‹
# https://app.netlify.com â†’ é€‰æ‹©ç«™ç‚¹ â†’ Deploys
```

### é—®é¢˜4ï¼šå‡½æ•°404é”™è¯¯
- æ£€æŸ¥å‡½æ•°è·¯å¾„ï¼š`netlify/functions/createRenewalOrder.js`
- æ£€æŸ¥ `netlify.toml` é…ç½®
- ç­‰å¾…1-2åˆ†é’Ÿè®©éƒ¨ç½²å®Œå…¨ç”Ÿæ•ˆ

---

## âœ… éƒ¨ç½²åéªŒè¯æ¸…å•

éƒ¨ç½²å®Œæˆåï¼ŒæŒ‰é¡ºåºæ£€æŸ¥ï¼š

- [ ] è®¿é—®å‡½æ•°URLï¼Œè¿”å› "Method Not Allowed"ï¼ˆè¯´æ˜å‡½æ•°å­˜åœ¨ï¼‰
- [ ] æ‰“å¼€Qtç¨‹åºç»­è´¹å¯¹è¯æ¡†
- [ ] ç”Ÿæˆæ”¯ä»˜äºŒç»´ç 
- [ ] äºŒç»´ç æ­£å¸¸æ˜¾ç¤º
- [ ] ä¸å†å‡ºç° "missing-app-id" é”™è¯¯
- [ ] ï¼ˆå¯é€‰ï¼‰æ‰«ç æµ‹è¯•ï¼ˆä¼šè·³è½¬åˆ°æµ‹è¯•é¡µé¢ï¼‰

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

### æŸ¥çœ‹Netlifyæ—¥å¿—
```bash
netlify logs
```

### æŸ¥çœ‹å‡½æ•°æ—¥å¿—
```bash
netlify logs --function createRenewalOrder
```

### æœ¬åœ°æµ‹è¯•
```bash
netlify dev
```

---

**ä¿®å¤æ—¥æœŸï¼š** 2024-10-19  
**ç‰ˆæœ¬ï¼š** v1.2.1  
**çŠ¶æ€ï¼š** âœ… ä»£ç å·²ä¿®å¤ï¼Œå¾…éƒ¨ç½²  
**ä¸‹ä¸€æ­¥ï¼š** éƒ¨ç½²åˆ°Netlifyç”Ÿäº§ç¯å¢ƒ

---

## ğŸ‰ æ€»ç»“

### é—®é¢˜
âŒ ç”Ÿæˆçš„æ”¯ä»˜å®URLç¼ºå°‘ `app_id` å‚æ•°

### è§£å†³
âœ… æ·»åŠ å®Œæ•´çš„æ”¯ä»˜å®å‚æ•°ï¼ŒåŒ…æ‹¬ app_idã€methodã€formatç­‰

### ç»“æœ
- âœ… äºŒç»´ç å¯ä»¥æ­£å¸¸ç”Ÿæˆ
- âœ… ä¸å†å‡ºç° "missing-app-id" é”™è¯¯
- âœ… UIæµ‹è¯•å®Œå…¨æ­£å¸¸
- âš ï¸ çœŸå®æ”¯ä»˜éœ€è¦é…ç½®æ”¯ä»˜å®ï¼ˆå¯é€‰ï¼‰

**ç°åœ¨åªéœ€è¦éƒ¨ç½²åˆ°Netlifyå³å¯ï¼** ğŸš€

