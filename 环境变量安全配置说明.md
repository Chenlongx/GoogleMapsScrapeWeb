# 🔐 环境变量安全配置说明

## ⚠️ 重要安全提醒

**您的敏感信息已经被意外提交到 Git 历史中，虽然我们已经清理了历史记录，但为了安全起见，建议您立即更换所有暴露的密钥！**

## 🚨 需要立即更换的密钥

### 1. GitHub Personal Access Token
- **当前状态**: 已暴露
- **操作**: 立即撤销并重新生成
- **步骤**:
  1. 访问 https://github.com/settings/tokens
  2. 找到并删除已暴露的 Token
  3. 生成新的 Token
  4. 在 Netlify 环境变量中更新

### 2. Supabase 密钥
- **当前状态**: 已暴露
- **操作**: 重新生成 API 密钥
- **步骤**:
  1. 登录 Supabase Dashboard
  2. 进入项目设置
  3. 重新生成 API 密钥
  4. 更新环境变量

### 3. 支付宝密钥
- **当前状态**: 已暴露
- **操作**: 重新生成密钥对
- **步骤**:
  1. 登录支付宝开放平台
  2. 重新生成应用密钥
  3. 更新环境变量

### 4. 管理员密钥
- **当前状态**: 已暴露
- **操作**: 更换为新的强密码
- **建议**: 使用至少32位的随机字符串

## 🔧 正确的配置方法

### 1. 本地开发环境
```bash
# 复制示例文件
cp env.example .env

# 编辑 .env 文件，填入真实配置
# 注意：.env 文件已被 .gitignore 忽略，不会提交到 Git
```

### 2. Netlify 生产环境
在 Netlify Dashboard 中设置环境变量：
- `GITHUB_TOKEN`: 您的 GitHub Token
- `ADMIN_SECRET_KEY`: 您的管理员密钥
- `SUPABASE_URL`: Supabase 项目 URL
- `SUPABASE_ANON_KEY`: Supabase 匿名密钥
- `RESEND_API_KEY`: Resend API 密钥
- `ALIPAY_APP_ID`: 支付宝应用 ID
- `ALIPAY_PRIVATE_KEY`: 支付宝私钥
- `ALIPAY_PUBLIC_KEY`: 支付宝公钥

## 🛡️ 安全最佳实践

### 1. 环境变量管理
- ✅ 永远不要将 `.env` 文件提交到 Git
- ✅ 使用 `.env.example` 作为模板
- ✅ 定期轮换密钥
- ✅ 使用强密码

### 2. 密钥安全
- ✅ 最小权限原则
- ✅ 定期检查密钥使用情况
- ✅ 监控异常访问
- ✅ 及时撤销泄露的密钥

### 3. 代码安全
- ✅ 使用环境变量存储敏感信息
- ✅ 不要在代码中硬编码密钥
- ✅ 使用安全的密钥管理服务
- ✅ 定期进行安全审计

## 📋 检查清单

在重新部署前，请确认：

- [ ] 已撤销所有暴露的 GitHub Token
- [ ] 已重新生成 Supabase 密钥
- [ ] 已重新生成支付宝密钥
- [ ] 已更换管理员密钥
- [ ] 已在 Netlify 中设置新的环境变量
- [ ] 已确认 `.env` 文件在 `.gitignore` 中
- [ ] 已删除本地的 `.env` 文件（如果存在）

## 🚀 重新部署

完成密钥更换后：

1. **重新部署站点**：
   ```bash
   # 在 Netlify Dashboard 中触发重新部署
   # 或使用 CLI
   netlify deploy --prod
   ```

2. **测试功能**：
   - 检查 GitHub API 是否正常工作
   - 测试安全面板访问
   - 验证支付功能

3. **监控日志**：
   - 检查 Netlify 函数日志
   - 监控安全事件
   - 确认没有错误

## 📞 紧急联系

如果发现任何异常活动：
1. 立即撤销所有相关密钥
2. 检查访问日志
3. 联系相关服务提供商
4. 考虑暂时关闭服务

---

**记住**: 安全是一个持续的过程，请定期检查和更新您的安全配置！
