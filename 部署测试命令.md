# éƒ¨ç½²å’Œæµ‹è¯•å‘½ä»¤

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰

### æ­¥éª¤1ï¼šåˆ‡æ¢ç›®å½•
```bash
cd D:\GoogleMapsScrapeWeb
```

### æ­¥éª¤2ï¼šæ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶
```bash
# æŸ¥çœ‹ä¿®æ”¹çš„å‡½æ•°
dir netlify\functions\*.js
```

åº”è¯¥çœ‹åˆ°ï¼š
- âœ… `createRenewalOrder.js` - å·²ä¿®å¤
- âœ… `checkPaymentStatus.js` - å·²ä¿®å¤
- âœ… `alipayCallback.js` - å·²ä¿®å¤

### æ­¥éª¤3ï¼šéƒ¨ç½²åˆ°Netlify
```bash
# å¦‚æœå°šæœªç™»å½•
netlify login

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
netlify deploy --prod
```

**æŒ‰æç¤ºæ“ä½œï¼š**
1. é€‰æ‹©å‘å¸ƒç›®å½•ï¼š`public` (æˆ–è€…æŒ‰å›è½¦ä½¿ç”¨é»˜è®¤)
2. ç­‰å¾…éƒ¨ç½²å®Œæˆ
3. çœ‹åˆ°æˆåŠŸæ¶ˆæ¯å’Œç½‘ç«™URL

---

## ğŸ§ª æµ‹è¯•å‘½ä»¤

### æµ‹è¯•1ï¼šåˆ›å»ºè®¢å•ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰
```bash
curl -X POST https://mediamingle.cn/.netlify/functions/createRenewalOrder \
  -H "Content-Type: application/json" \
  -d "{\"userId\":\"test_user\",\"username\":\"test@example.com\",\"renewalType\":\"monthly\",\"amount\":29.90,\"duration\":\"1ä¸ªæœˆ\",\"productName\":\"è°·æ­Œåœ°å›¾å•†å®¶çˆ¬è™«-æœˆä»˜\"}"
```

**é¢„æœŸå“åº”ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰ï¼š**
```json
{
  "success": true,
  "message": "è®¢å•åˆ›å»ºæˆåŠŸï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰",
  "orderId": "MOCK_1697720000000_abc123",
  "paymentUrl": "https://qr.alipay.com/baxMOCK_1697720000000_abc123",
  "mode": "mock",
  "note": "è¿™æ˜¯æµ‹è¯•æ¨¡å¼ï¼Œè¯·é…ç½®Supabaseç¯å¢ƒå˜é‡ä»¥ä½¿ç”¨çœŸå®è®¢å•ç³»ç»Ÿ"
}
```

**âœ… æˆåŠŸæ ‡å¿—ï¼š**
- è¿”å›JSONæ ¼å¼
- `success: true`
- åŒ…å« `mode: "mock"`
- æ²¡æœ‰500/502é”™è¯¯

---

### æµ‹è¯•2ï¼šæ£€æŸ¥æ”¯ä»˜çŠ¶æ€ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰
```bash
curl -X POST https://mediamingle.cn/.netlify/functions/checkPaymentStatus \
  -H "Content-Type: application/json" \
  -d "{\"orderId\":\"MOCK_123\",\"userId\":\"test_user\"}"
```

**é¢„æœŸå“åº”ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰ï¼š**
```json
{
  "success": true,
  "status": "pending",
  "message": "æ”¯ä»˜çŠ¶æ€æŸ¥è¯¢ä¸­ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰",
  "mode": "mock",
  "note": "è¿™æ˜¯æµ‹è¯•æ¨¡å¼ï¼Œè¯·é…ç½®Supabaseç¯å¢ƒå˜é‡ä»¥ä½¿ç”¨çœŸå®è®¢å•ç³»ç»Ÿ"
}
```

---

### æµ‹è¯•3ï¼šæ”¯ä»˜å›è°ƒï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰
```bash
curl -X POST https://mediamingle.cn/.netlify/functions/alipayCallback \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "out_trade_no=MOCK_123&trade_status=TRADE_SUCCESS"
```

**é¢„æœŸå“åº”ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰ï¼š**
```
success
```

---

## ğŸ¯ å‰ç«¯æµ‹è¯•

### æ­¥éª¤1ï¼šå¯åŠ¨ç¨‹åº
```bash
cd D:\gogole_maps
python Maps_scraper.py
```

### æ­¥éª¤2ï¼šæ‰“å¼€ç»­è´¹å¯¹è¯æ¡†
1. ç‚¹å‡»èœå•ï¼š**å¸®åŠ©** â†’ **ç»­è´¹æœåŠ¡**
2. é€‰æ‹©ç»­è´¹æ–¹æ¡ˆï¼ˆæœˆä»˜/å­£ä»˜/å¹´ä»˜ï¼‰
3. ç‚¹å‡»ï¼š**ç”Ÿæˆæ”¯ä»˜äºŒç»´ç **

### æ­¥éª¤3ï¼šéªŒè¯ç»“æœ

**æˆåŠŸæƒ…å†µï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰ï¼š**
- âœ… æ˜¾ç¤ºæ”¯ä»˜å®äºŒç»´ç 
- âœ… çŠ¶æ€æ˜¾ç¤ºï¼š"âœ… è¯·ä½¿ç”¨æ”¯ä»˜å®æ‰«ç æ”¯ä»˜"
- âœ… äºŒç»´ç å¯ä»¥æ˜¾ç¤ºï¼ˆè™½ç„¶æ˜¯æ¨¡æ‹ŸURLï¼‰
- âœ… æ²¡æœ‰502é”™è¯¯

**æ³¨æ„äº‹é¡¹ï¼š**
- âš ï¸ æ”¯ä»˜æ£€æµ‹ä¸ä¼šæˆåŠŸï¼ˆå› ä¸ºæ˜¯æ¨¡æ‹Ÿè®¢å•ï¼‰
- âš ï¸ æ‰«ç åä¸ä¼šçœŸå®æ”¯ä»˜
- âš ï¸ è¿™åªæ˜¯UIæµ‹è¯•

**å¦‚æœéœ€è¦ç½‘é¡µç»­è´¹ï¼š**
- ç‚¹å‡»å¯¹è¯æ¡†åº•éƒ¨çš„é“¾æ¥
- æˆ–åœ¨é”™è¯¯æ—¶é€‰æ‹©"æ‰“å¼€ç½‘é¡µç»­è´¹"

---

## ğŸ“Š æµ‹è¯•ç»“æœåˆ¤æ–­

### âœ… æˆåŠŸæ ‡å¿—
- [ ] éƒ¨ç½²å‘½ä»¤æ‰§è¡ŒæˆåŠŸ
- [ ] æµ‹è¯•1è¿”å›JSONï¼ˆåŒ…å«mode: "mock"ï¼‰
- [ ] æµ‹è¯•2è¿”å›JSONï¼ˆåŒ…å«mode: "mock"ï¼‰
- [ ] æµ‹è¯•3è¿”å›"success"
- [ ] å‰ç«¯å¯ä»¥ç”ŸæˆäºŒç»´ç 
- [ ] æ²¡æœ‰500/502é”™è¯¯

### âŒ å¤±è´¥æƒ…å†µ

#### 502 Bad Gateway
**åŸå› ï¼š** å‡½æ•°æœªæ­£ç¡®éƒ¨ç½²
**è§£å†³ï¼š** é‡æ–°è¿è¡Œ `netlify deploy --prod`

#### 404 Not Found
**åŸå› ï¼š** å‡½æ•°è·¯å¾„é”™è¯¯
**è§£å†³ï¼š** æ£€æŸ¥å‡½æ•°æ˜¯å¦åœ¨ `netlify/functions/` ç›®å½•

#### supabaseKey is required
**åŸå› ï¼š** æ—§ä»£ç æœªæ›´æ–°
**è§£å†³ï¼š** ç¡®è®¤ä¿®æ”¹å·²ä¿å­˜ï¼Œé‡æ–°éƒ¨ç½²

---

## ğŸ”„ æ›´æ–°æµç¨‹

å¦‚æœéœ€è¦ä¿®æ”¹ä»£ç ï¼š

```bash
# 1. ä¿®æ”¹ä»£ç 
# ç¼–è¾‘ D:\GoogleMapsScrapeWeb\netlify\functions\*.js

# 2. é‡æ–°éƒ¨ç½²
cd D:\GoogleMapsScrapeWeb
netlify deploy --prod

# 3. æµ‹è¯•
curl https://mediamingle.cn/.netlify/functions/createRenewalOrder

# 4. å‰ç«¯æµ‹è¯•
cd D:\gogole_maps
python Maps_scraper.py
```

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: éƒ¨ç½²åè¿˜æ˜¯502é”™è¯¯ï¼Ÿ
**A:** ç­‰å¾…1-2åˆ†é’Ÿè®©Netlifyå®Œå…¨éƒ¨ç½²ï¼Œç„¶åå†æµ‹è¯•ã€‚

### Q2: å‰ç«¯è¿˜æ˜¯æ˜¾ç¤º"æœåŠ¡å™¨é”™è¯¯: 502"ï¼Ÿ
**A:** 
1. ç¡®è®¤åç«¯å·²éƒ¨ç½²æˆåŠŸï¼ˆç”¨curlæµ‹è¯•ï¼‰
2. æ¸…é™¤å‰ç«¯ç¼“å­˜ï¼Œé‡å¯ç¨‹åº
3. æ£€æŸ¥ç½‘ç»œè¿æ¥

### Q3: æ¨¡æ‹Ÿæ¨¡å¼çš„äºŒç»´ç èƒ½ç”¨å—ï¼Ÿ
**A:** ä¸èƒ½çœŸå®æ”¯ä»˜ï¼Œä½†å¯ä»¥æµ‹è¯•UIã€‚è¦çœŸå®æ”¯ä»˜éœ€è¦ï¼š
1. é…ç½®Supabaseç¯å¢ƒå˜é‡
2. é…ç½®æ”¯ä»˜å®å‚æ•°
3. æˆ–ä½¿ç”¨ç½‘é¡µç»­è´¹

### Q4: å¦‚ä½•åˆ‡æ¢åˆ°çœŸå®æ¨¡å¼ï¼Ÿ
**A:** 
1. åœ¨Netlifyé…ç½®ç¯å¢ƒå˜é‡ï¼š
   - `SUPABASE_URL`
   - `SUPABASE_SERVICE_KEY`
2. åœ¨Supabaseåˆ›å»ºæ•°æ®åº“è¡¨
3. é‡æ–°éƒ¨ç½²

### Q5: æ”¯ä»˜æ£€æµ‹ä¸ºä»€ä¹ˆä¸€ç›´pendingï¼Ÿ
**A:** åœ¨æ¨¡æ‹Ÿæ¨¡å¼ä¸‹ï¼Œæ”¯ä»˜æ£€æµ‹æ°¸è¿œè¿”å›pendingã€‚è¿™æ˜¯æ­£å¸¸çš„ã€‚

---

## ğŸ‰ å®Œæˆç¡®è®¤

éƒ¨ç½²æˆåŠŸçš„æ ‡å¿—ï¼š

```bash
# è¿è¡Œè¿™ä¸ªå‘½ä»¤
curl https://mediamingle.cn/.netlify/functions/createRenewalOrder

# å¦‚æœçœ‹åˆ°è¿™æ ·çš„å“åº”ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼š
{
  "success": false,
  "message": "Method Not Allowed"
}

# æˆ–è€…ï¼ˆPOSTè¯·æ±‚åï¼‰ï¼š
{
  "success": true,
  "mode": "mock",
  ...
}
```

**ä¸åº”è¯¥çœ‹åˆ°ï¼š**
- âŒ 502 Bad Gateway
- âŒ 404 Not Found
- âŒ supabaseKey is required

---

## ğŸ“ ä¸‹ä¸€æ­¥

### ç«‹å³å¯ç”¨ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰âœ…
- [x] ä¿®å¤ä»£ç 
- [x] éƒ¨ç½²åˆ°Netlify
- [x] æµ‹è¯•API
- [x] æµ‹è¯•å‰ç«¯
- [x] ç”¨æˆ·å¯é€šè¿‡ç½‘é¡µç»­è´¹

### é•¿æœŸä¼˜åŒ–ï¼ˆçœŸå®æ¨¡å¼ï¼‰â³
- [ ] é…ç½®Supabaseç¯å¢ƒå˜é‡
- [ ] åˆ›å»ºæ•°æ®åº“è¡¨
- [ ] é…ç½®æ”¯ä»˜å®å‚æ•°ï¼ˆå¯é€‰ï¼‰
- [ ] å®Œæ•´æµ‹è¯•çœŸå®æ”¯ä»˜æµç¨‹

---

**æ›´æ–°æ—¶é—´ï¼š** 2024-10-19  
**çŠ¶æ€ï¼š** âœ… ä»£ç å·²ä¿®å¤ï¼Œæ”¯æŒæ¨¡æ‹Ÿæ¨¡å¼  
**ä¸‹ä¸€æ­¥ï¼š** éƒ¨ç½²å¹¶æµ‹è¯•

